#!/usr/bin/env bash
set -eu

echo "updating properties"
wd sparql ./scripts/assets/properties.rq --index property > ./scripts/assets/properties.json

# Using printf to avoid getting an undesired newline break
printf "// Generated by scripts/update_properties\nmodule.exports = " > ./assets/js/properties.js.tmp
./scripts/get_properties_index >> ./assets/js/properties.js.tmp

# Now that risky operations are over, we can cleanup
# with a low risk of crashing and letting empty files behind us
mv ./assets/js/properties.js.tmp ./assets/js/properties.js

echo "generating properties index"
./scripts/generate_properties_index

echo "copying the index in the public folder to make it publicly accessible"
cp ./assets/js/properties_index.js ./public/properties_index.js

echo "generating properties links data"
# Disable requests logs to prevent
# `RangeError [ERR_CHILD_PROCESS_STDIO_MAXBUFFER]: stdout maxBuffer length exceeded`
export HUB_VERBOSE_REQUESTS=false
./scripts/generate_links_data
